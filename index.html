<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FrostBot.Ai</title>
    <meta name="description" content="FrostBot.Ai - Your AI chat assistant with file upload, rapid answers, and frosty flair." />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" />
    <style>
      :root {
        --font: 'Inter', sans-serif;
        --bg: #ffffff;
        --text: #1a1a1a;
        --accent: #000000;
        --bot-bg: #f5f5f5;
        --user-bg: #e0e0e0;
        --input-bg: #ffffff;
      }
      [data-theme="dark"] {
        --bg: #1a1a1a;
        --text: #f5f5f5;
        --accent: #ffffff;
        --bot-bg: #2a2a2a;
        --user-bg: #444;
        --input-bg: #2a2a2a;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html, body {
        font-family: var(--font);
        background: var(--bg);
        color: var(--text);
        height: 100%;
        overflow: hidden;
      }
      .top-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: var(--bg);
        padding: 12px 20px;
        font-weight: bold;
        text-align: center;
        z-index: 1000;
        border-bottom: 1px solid #ccc;
      }
      .login-button {
        position: fixed;
        top: 12px;
        right: 20px;
        background: var(--accent);
        color: var(--bg);
        padding: 6px 12px;
        border-radius: 6px;
        text-decoration: none;
        z-index: 1001;
      }
      .sidebar {
        position: fixed;
        top: 50px;
        left: 0;
        bottom: 0;
        width: 260px;
        padding: 20px;
        background: var(--bg);
        border-right: 1px solid #ccc;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        z-index: 999;
      }
      .sidebar h1 {
        font-size: 1.3rem;
      }
      .chat-box {
        position: absolute;
        top: 50px;
        left: 260px;
        right: 0;
        bottom: 80px;
        overflow-y: auto;
        padding: 20px;
      }
      .message {
        max-width: 80%;
        padding: 12px 18px;
        margin: 10px;
        border-radius: 16px;
        white-space: pre-wrap;
      }
      .user { align-self: flex-end; background: var(--user-bg); }
      .assistant { align-self: flex-start; background: var(--bot-bg); }
      .input-area {
        position: fixed;
        bottom: 0;
        left: 260px;
        right: 0;
        background: var(--input-bg);
        padding: 14px;
        border-top: 1px solid #ccc;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .input-area textarea {
        flex: 1;
        font-size: 1rem;
        border-radius: 20px;
        border: 1px solid #ccc;
        padding: 10px 14px;
        resize: none;
        outline: none;
        background: var(--bg);
        color: var(--text);
      }
      .input-area button {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        font-size: 1.2rem;
        border: none;
        cursor: pointer;
      }
      .ad-slot {
        margin-top: auto;
        font-size: 0.8rem;
        color: #888;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="top-bar">FrostBot.Ai</div>
    <a href="login.html" class="login-button" id="loginBtn">Login</a>

    <div class="sidebar">
      <div>
        <h1>FrostBot.Ai</h1>
        <button onclick="toggleTheme()">Toggle Theme</button>
        <button onclick="logoutUser()">Logout</button>
      </div>
      <div class="ad-slot">
        <!-- Monetag Script Here -->
        <script src="https://a.monetag.com/frostBotAi.js" async></script>
      </div>
    </div>

    <div class="chat-box" id="chatBox">
      <div class="message assistant">❄️ Welcome, traveler. What frost-bitten wisdom do you seek today?</div>
    </div>

    <div class="input-area">
      <textarea id="userInput" placeholder="Send a message..."></textarea>
      <button onclick="sendMessage()">→</button>
    </div>

    <script>
      const OPENROUTER_KEY = "pk-pub-XXREDACTEDXX"; // Replace with real key

      const chatBox = document.getElementById('chatBox');
      const userInput = document.getElementById('userInput');
      const loginBtn = document.getElementById('loginBtn');

      function appendMessage(text, type) {
        const msg = document.createElement('div');
        msg.className = `message ${type}`;
        msg.textContent = text;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      async function sendMessage() {
        const input = userInput.value.trim();
        if (!input) return;
        appendMessage(input, 'user');
        userInput.value = '';

        const history = [...document.querySelectorAll('.message')]
          .map(el => ({ role: el.classList.contains('user') ? 'user' : 'assistant', content: el.textContent }))
          .slice(-10);

        const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${OPENROUTER_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: 'openai/gpt-3.5-turbo',
            messages: history
          })
        });

        if (!res.ok) {
          appendMessage('⚠️ You might have reached your usage limit. Please wait or upgrade.', 'assistant');
          return;
        }

        const data = await res.json();
        appendMessage(data.choices[0].message.content, 'assistant');
      }

      userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      function toggleTheme() {
        const html = document.documentElement;
        const now = html.getAttribute('data-theme');
        html.setAttribute('data-theme', now === 'dark' ? 'light' : 'dark');
      }

      function logoutUser() {
        localStorage.removeItem('frostbotUser');
        loginBtn.style.display = 'block';
        alert('Logged out');
      }

      window.onload = () => {
        const isLogged = localStorage.getItem('frostbotUser');
        if (!isLogged) {
          document.querySelector('button[onclick="logoutUser()"]')?.style.display = 'none';
        } else {
          loginBtn.style.display = 'none';
        }
      }
    </script>
  </body>
</html>
